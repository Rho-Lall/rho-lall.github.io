{"componentChunkName":"component---src-pages-thoughts-mdx-slug-js","path":"/thoughts/snowflake-datediff-business-days/","result":{"data":{"mdx":{"frontmatter":{"title":"Snowflake DateDiff Business Days: How do I exclude weekends?","short":"\nA common ask in analytics engineering is to return the working days between two dates not the calendar days.\n","keywords":"snowflake datediff business days, working days between two dates, snowflake networkdays, analytics engineering, data driven development","hero_alt":"Snowflake DateDiff Business Days: How do I exclude weekends between two dates in Snowflake SQL?","date":"July 24, 2023","hero_image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/217ac44efb5208795651dee9b027be72/87706/development_sql.png","srcSet":"/static/217ac44efb5208795651dee9b027be72/f80f8/development_sql.png 320w,\n/static/217ac44efb5208795651dee9b027be72/9a63f/development_sql.png 640w,\n/static/217ac44efb5208795651dee9b027be72/87706/development_sql.png 1280w","sizes":"(min-width: 1280px) 1280px, 100vw"},"sources":[{"srcSet":"/static/217ac44efb5208795651dee9b027be72/c0bcc/development_sql.webp 320w,\n/static/217ac44efb5208795651dee9b027be72/17574/development_sql.webp 640w,\n/static/217ac44efb5208795651dee9b027be72/71d4d/development_sql.webp 1280w","type":"image/webp","sizes":"(min-width: 1280px) 1280px, 100vw"}]},"width":1280,"height":720}}}},"slug":"snowflake-datediff-business-days","body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (-1 !== e.indexOf(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Snowflake DateDiff Business Days: How do I exclude weekends?\",\n  \"date\": \"2023-07-24\",\n  \"hero_image\": \"./media/development_sql.png\",\n  \"hero_alt\": \"Snowflake DateDiff Business Days: How do I exclude weekends between two dates in Snowflake SQL?\",\n  \"expertise\": \"Development\",\n  \"author\": \"Rho Lall\",\n  \"keywords\": \"snowflake datediff business days, working days between two dates, snowflake networkdays, analytics engineering, data driven development\",\n  \"short\": \"\\nA common ask in analytics engineering is to return the working days between two dates not the calendar days.\\n\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This is the code leverages Snowflake DateDiff to calculate business days.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"select\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DATEDIFF('day', '2022-07-01', '2022-07-14') + 1\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', DATEADD('day', 1, '2022-07-14'))\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', '2022-07-14') as working_days\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \";\")), mdx(\"p\", null, \"It looks a little wonky. I'll break it down into steps. Basically we are calculating three values: a, b, & c. Then we are subtracting b & c from a: a-b-c. \"), mdx(\"h2\", null, \"DateDiff Naive Count of Days\"), mdx(\"p\", null, \"This first expression naively counts days between start and end. The +1 means the end date is included as part of the count.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DATEDIFF('day', '2022-07-01', '2022-07-14') + 1\")), mdx(\"h2\", null, \"Subtract Saturdays\"), mdx(\"p\", null, \"This second expression counts Saturdays. There can never be fewer Saturdays than Sundays in a given range because Snowflake starts the week on Monday and Sunday is after Saturday. We want to check whether the last day in the range is a Saturday. This expression checks by calculating how many weeks there are in this range if the last day is forwarded by one day.\"), mdx(\"p\", null, \"For example, if the last day is a Friday, then it moves to Saturday, and that partial week doesn't count towards our total because DATEDIFF('week', ...) only counts fully completed weeks. \"), mdx(\"p\", null, \"However, if the last day is a Saturday, then it gets bumped to a Sunday, and this count will increase.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', DATEADD('day', 1, '2022-07-14'))\")), mdx(\"h2\", null, \"Subtract Sundays\"), mdx(\"p\", null, \"This third piece counts the number of fully completed weeks, which will be the same as the number of Sundays in that range (there is one Sunday per week).        \"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', '2022-07-14')\")), mdx(\"h2\", null, \"Putting it all together with DateDiff to get Business Days\"), mdx(\"p\", null, \"Putting all the expressions together, we subtract the Saturday count and Sunday count from the first naive count to calculate the number of weekdays elapsed in the time range.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"select\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DATEDIFF('day', '2022-07-01', '2022-07-14') + 1\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', DATEADD('day', 1, '2022-07-14'))\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"- DATEDIFF('week', '2022-07-01', '2022-07-14') as working_days\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \";\")), mdx(\"p\", null, \"This pattern can be adjusted to accommodate different week start days.\"), mdx(\"h2\", null, \"Plus 5 Business Days\"), mdx(\"p\", null, \"As a follow up to the same idea I had to deploy logic that returned the date that is 5 business days from any given calendar date. It's pretty straightforward once you wrap your head around it. Including examples for plus 4 business days as well.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \",  case\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when day_name = 'Sunday' then dateadd('day',4,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when day_name = 'Monday' then dateadd('day',4,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when day_name = 'Saturday' then dateadd('day',5,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"else dateadd('day',6,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"end as plus_4_business_days\"), \" \"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \", case\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when day_name = 'Sunday' then dateadd('day',5,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"when day_name = 'Saturday' then dateadd('day',6,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"else dateadd('day',7,date)\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"end as plus_5_business_days\")), mdx(\"h3\", null, \"Resources:\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.snowflake.com/en/sql-reference/functions-date-time.html#label-calendar-weeks-weekdays\"\n  }, \"Snowflake Docs\")));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"6318680a-6f2f-5d4e-b069-0a08c6c25c50","slug":"snowflake-datediff-business-days","__params":{"slug":"snowflake-datediff-business-days"}}},"staticQueryHashes":["1609057278"]}