{"version":3,"file":"component---src-pages-one-time-offer-6-month-roi-strategy-map-special-bonus-js-604e2dfe012a88e27be7.js","mappings":"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","sources":["webpack://assume-wisely-blog/./src/funnel-0ps/templates/UpsellPageTemplate.js","webpack://assume-wisely-blog/./src/pages/one-time-offer/6-month-roi-strategy-map/special-bonus.js"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Helmet } from 'react-helmet'\nimport { navigate } from 'gatsby'\nimport OTOContent from '../components/OTOContent'\n\n/**\n * Upsell Page Template\n * \n * Reusable template for one-click upsell pages that handles all boilerplate:\n * - Layout wrapper (provided by consuming project)\n * - Helmet/SEO configuration\n * - Test mode banner\n * - Session ID extraction from URL\n * - One-click upsell API integration\n * - OTOContent component integration\n * - Error handling and loading states\n * \n * @param {Object} Layout - Layout component from consuming project (required)\n * @param {Object} offerData - OTO configuration object (required)\n * @param {string} declineUrl - URL when declining offer (required)\n * @param {string} getUpsellTokenApi - API endpoint for getting upsell token (optional)\n * @param {string} oneClickUpsellApi - API endpoint for one-click upsell (optional)\n */\nconst UpsellPageTemplate = ({ \n  Layout, \n  offerData, \n  declineUrl,\n  getUpsellTokenApi = 'https://payment.bulldozer.life/ecommerce/get-upsell-token',\n  oneClickUpsellApi = 'https://payment.bulldozer.life/ecommerce/one-click-upsell'\n}) => {\n  // Validate required props\n  if (!Layout) {\n    throw new Error('UpsellPageTemplate requires Layout prop')\n  }\n  if (!offerData) {\n    throw new Error('UpsellPageTemplate requires offerData prop')\n  }\n  if (!declineUrl) {\n    throw new Error('UpsellPageTemplate requires declineUrl prop')\n  }\n\n  const [stripeSessionId, setStripeSessionId] = useState('')\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [error, setError] = useState('')\n\n  // Determine if we're in test mode\n  const isTest = process.env.GATSBY_ISTEST === 'true'\n  \n  // Select the correct price ID based on test mode\n  const priceId = isTest ? offerData.stripe.test_priceId : offerData.stripe.price_id\n\n  // Extract Stripe session ID from URL on mount\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n\n    const urlParams = new URLSearchParams(window.location.search)\n    const sessionId = urlParams.get('session_id')\n    \n    if (!sessionId) {\n      console.warn('No session_id found in URL')\n      navigate(declineUrl)\n      return\n    }\n\n    setStripeSessionId(sessionId)\n  }, [declineUrl])\n\n  // Handle one-click purchase\n  const handlePurchase = async () => {\n    if (!stripeSessionId) {\n      setError('Invalid session. Please try again.')\n      return\n    }\n\n    setIsProcessing(true)\n    setError('')\n\n    // Create abort controller for timeout handling\n    const controller = new AbortController()\n    const timeoutId = setTimeout(() => controller.abort(), 30000) // 30 second timeout\n\n    try {\n      // Step 1: Get UUID from Stripe session ID with retry logic\n      // Retry up to 10 times with exponential backoff (webhook may still be processing)\n      let uuidData = null\n      let lastError = null\n      \n      for (let i = 0; i < 10; i++) {\n        try {\n          const uuidResponse = await fetch(`${getUpsellTokenApi}?session_id=${stripeSessionId}&isTest=${isTest}`, {\n            signal: controller.signal,\n          })\n\n          if (!uuidResponse.ok) {\n            const errorData = await uuidResponse.json().catch(() => ({}))\n            lastError = new Error(errorData.error?.message || 'Failed to retrieve session')\n            \n            // If it's a \"not found\" error, retry with backoff\n            if (errorData.found === false || uuidResponse.status === 404) {\n              await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1))) // Exponential backoff\n              continue\n            }\n            \n            // For other errors, throw immediately\n            throw lastError\n          }\n\n          const data = await uuidResponse.json()\n          \n          if (data.success && data.upsellToken) {\n            uuidData = data\n            break\n          }\n          \n          // Session not ready yet, retry with backoff\n          if (data.found === false) {\n            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)))\n            continue\n          }\n          \n          throw new Error('Invalid session response')\n          \n        } catch (err) {\n          if (err.name === 'AbortError') throw err // Don't retry on timeout\n          lastError = err\n          \n          // Last attempt failed\n          if (i === 9) throw lastError\n          \n          // Retry with backoff\n          await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)))\n        }\n      }\n      \n      if (!uuidData || !uuidData.upsellToken) {\n        throw new Error(lastError?.message || 'Payment session not ready. Please try again.')\n      }\n\n      // Step 2: Process one-click upsell with UUID\n      const upsellResponse = await fetch(oneClickUpsellApi, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          upsellToken: uuidData.upsellToken,\n          priceId: priceId,\n        }),\n        signal: controller.signal,\n      })\n\n      clearTimeout(timeoutId)\n\n      if (!upsellResponse.ok) {\n        const errorData = await upsellResponse.json().catch(() => ({}))\n        throw new Error(errorData.error?.message || `Server error: ${upsellResponse.status}`)\n      }\n\n      const data = await upsellResponse.json()\n\n      if (!data.success) {\n        throw new Error(data.error?.message || 'Payment failed. Please try again.')\n      }\n\n      // Success - redirect to decline URL (typically thank you page)\n      navigate(declineUrl)\n\n    } catch (err) {\n      clearTimeout(timeoutId)\n\n      // Handle specific error types\n      let errorMessage = 'Unable to process payment. Please try again.'\n\n      if (err.name === 'AbortError') {\n        errorMessage = 'Request timed out. Please check your internet connection and try again.'\n      } else if (err.message.includes('Failed to fetch') || err.message.includes('NetworkError')) {\n        errorMessage = 'Network error. Please check your internet connection and try again.'\n      } else if (err.message) {\n        errorMessage = err.message\n      }\n\n      setError(errorMessage)\n      console.error('One-click upsell error:', err)\n      setIsProcessing(false)\n    }\n  }\n\n  // Handle decline - redirect to decline URL\n  const handleDecline = () => {\n    navigate(declineUrl)\n  }\n\n  return (\n    <Layout pageTitle={offerData.meta.title}>\n      <Helmet>\n        <title>{offerData.meta.title}</title>\n        <meta name=\"description\" content={offerData.meta.description} />\n        <meta name=\"robots\" content=\"noindex, nofollow\" />\n      </Helmet>\n\n      {/* Test Mode Banner */}\n      {isTest && (\n        <div className=\"bg-yellow-400 text-black text-center py-2 px-4 font-bold\">\n          ⚠️ TEST MODE - Using test Stripe keys and test price IDs\n        </div>\n      )}\n\n      <OTOContent \n        offerData={offerData}\n        progressText=\"Congratulations! One More Thing...\"\n        timerMinutes={offerData.timer_minutes}\n      >\n        {/* Error Message */}\n        {error && (\n          <div className=\"mb-6 p-4 rounded-lg bg-red-100 border border-red-400 text-red-700\">\n            <p className=\"font-semibold mb-1\">Payment Error</p>\n            <p>{error}</p>\n          </div>\n        )}\n\n        {/* One-Click Purchase Buttons */}\n        <div className=\"text-center space-y-4 mt-8\">\n          {/* One-Click Purchase Button */}\n          <button\n            onClick={handlePurchase}\n            disabled={isProcessing || !stripeSessionId}\n            className={`w-full font-bold py-4 px-8 text-xl rounded-lg transition duration-200 shadow-lg hover:shadow-xl ${\n              isProcessing || !stripeSessionId\n                ? 'bg-gray-400 cursor-not-allowed'\n                : 'bg-green-600 hover:bg-green-700 text-white'\n            }`}\n          >\n            {isProcessing ? (\n              <span className=\"flex items-center justify-center gap-2\">\n                <svg className=\"animate-spin h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                </svg>\n                Processing...\n              </span>\n            ) : (\n              offerData.buttons.primary_text || 'Yes! Add This To My Order'\n            )}\n          </button>\n\n          {/* Decline Button */}\n          <button\n            onClick={handleDecline}\n            disabled={isProcessing}\n            className=\"block w-full text-blue-600 hover:text-blue-800 underline bg-transparent border-0 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {offerData.buttons.secondary_text || \"No thanks, I'll pass on this offer\"}\n          </button>\n        </div>\n\n        {/* Trust Indicators */}\n        <div className=\"mt-8 pt-8 border-t border-gray-200\">\n          <div className=\"flex flex-wrap justify-center items-center gap-6 text-sm text-gray-600\">\n            <div className=\"flex items-center gap-2\">\n              <svg className=\"w-5 h-5 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n              </svg>\n              <span>Secure Payment</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <svg className=\"w-5 h-5 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n              </svg>\n              <span>One-Click Checkout</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <svg className=\"w-5 h-5 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n              </svg>\n              <span>Money-Back Guarantee</span>\n            </div>\n          </div>\n        </div>\n      </OTOContent>\n    </Layout>\n  )\n}\n\nexport default UpsellPageTemplate\n","import React from 'react'\nimport LayoutSales from '../../../components/layout-sales'\nimport UpsellPageTemplate from '../../../funnel-0ps/templates/UpsellPageTemplate'\nimport offerData from '../../../data/oto/6-month-roi-strategy-map'\n\n/**\n * One-Click Upsell Page: 6 Month ROI Strategy Map\n * \n * Post-purchase upsell page that allows customers to add this offer\n * using their existing payment method without re-entering card details.\n * \n * Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 5.1, 5.2, 6.4, 10.1\n */\n\nconst OneClickUpsellPage = () => {\n  return (\n    <UpsellPageTemplate\n      Layout={LayoutSales}\n      offerData={offerData}\n      declineUrl=\"/thankyou/\"\n    />\n  )\n}\n\nexport default OneClickUpsellPage\n"],"names":["_ref","Layout","offerData","declineUrl","getUpsellTokenApi","oneClickUpsellApi","Error","stripeSessionId","setStripeSessionId","useState","isProcessing","setIsProcessing","error","setError","isTest","process","priceId","stripe","price_id","useEffect","window","sessionId","URLSearchParams","location","search","get","console","warn","navigate","React","pageTitle","meta","title","Helmet","name","content","description","OTOContent","progressText","timerMinutes","timer_minutes","className","onClick","async","controller","AbortController","timeoutId","setTimeout","abort","uuidData","lastError","i","uuidResponse","fetch","signal","ok","_errorData$error","errorData","json","catch","message","found","status","Promise","resolve","data","success","upsellToken","err","_lastError","upsellResponse","method","headers","body","JSON","stringify","clearTimeout","_errorData$error2","_data$error","errorMessage","includes","disabled","xmlns","fill","viewBox","cx","cy","r","stroke","strokeWidth","d","buttons","primary_text","handleDecline","secondary_text","fillRule","clipRule","OneClickUpsellPage","UpsellPageTemplate","LayoutSales"],"sourceRoot":""}